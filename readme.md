# 🚗 汽车用户评论智能分析系统

## 1\. 项目概述

本项目是一个自动化的用户评论分析流程，旨在从大量的汽车用户反馈中提取、量化并总结有价值的洞察。系统通过一个三步走的处理流水线，将非结构化的文本评论转化为结构化的深度分析报告，帮助产品、市场和研究团队快速理解用户痛点、发现产品亮点、并洞察核心用户需求。

整个流程始于原始评论数据，通过关键词匹配进行初步分类，随后利用大语言模型（LLM）进行情感和细分主题的精准分析，最后再通过LLM对各个主题下的观点进行聚合与深度总结，生成最终的分析报告。

## 2\. 核心特性 ✨

  - **🤖 自动化处理流程**: 只需运行主程序 `main.py`，即可一键完成从数据输入到报告输出的全过程。
  - **🧪 混合分析策略**: 结合了**关键词规则匹配**（高效、可控）和**大语言模型（LLM）分析**（精准、深度）的优点，实现了成本与效果的平衡。
  - **📈 多维度分析**: 不仅识别评论涉及的主题，还能精准判断用户情感（正面、负面、中性），并对各主题进行深度剖析。
  - **💡 深度洞察生成**: 最终报告包含对每个细分主题的 **4W1H 分析** (When, Where, Who, Why, How) 和**核心原始需求提炼**，提供超越简单统计的商业价值。
  - **🔧 高度可配置**: 所有的文件路径、API密钥、模型名称、关键词库、主题库等均可通过 `config.yaml` 文件进行配置，无需修改代码。
  - **⚡️ 高效并发处理**: 在调用LLM API时使用多线程并发，显著提升了处理大量评论时的效率。

## 3\. 工作流程 ⚙️

本系统的工作流程被清晰地划分为三个主要步骤，由 `main.py` 顺序调用执行。

-----

**➡️ 步骤 1️⃣: 🏷️ 关键词初步打标 (`tag_process.py`)**

  - **输入**: `input_data.csv` (包含原始用户评论) 和 `keywords.yaml` (关键词库)。
  - **过程**:
    1.  脚本读取 `input_data.csv` 文件中的评论数据。
    2.  加载 `keywords.yaml` 文件，为每个大类（如“价格”、“外观”）构建正则表达式。
    3.  遍历每一条评论，使用正则表达式匹配其中包含的关键词。
    4.  为每条评论打上一个或多个匹配到的大类标签。
  - **输出**: `output_tagged.csv`，在原数据基础上增加了一个“标签”列。

-----

**➡️ 步骤 2️⃣: 🧠 LLM 轻量级分析 (`llm_analyze.py`)**

  - **输入**: `output_tagged.csv` (上一步的输出) 和 `topics.yaml` (细分主题库)。
  - **过程**:
    1.  脚本读取带标签的评论数据。
    2.  对于每一条带有标签的评论，脚本会针对其每一个标签，调用一次LLM API。
    3.  LLM的任务是：
        a. **情感判断**: 判断该评论针对这个大类的情感是“正面”、“负面”还是“中性”。
        b. **主题提炼**: 从 `topics.yaml` 中为该大类预设的候选主题里，选择一个最匹配评论核心内容的细分主题。
  - **输出**: `output_analyzed.csv`。这是一个“长格式”文件，每一行代表一条评论在一个细分主题下的情感分析结果。

-----

**➡️ 步骤 3️⃣: 📝 聚合分析与报告生成 (`generate_report.py`)**

  - **输入**: `output_analyzed.csv` (上一步的输出)。
  - **过程**:
    1.  脚本读取所有细分主题的分析结果，并按“细分主题”和“情感”进行分组。
    2.  对于每个分组（例如：“内饰-用料与豪华感”下的所有“负面”评论），脚本会聚合该组内的所有评论。
    3.  再次调用LLM，但这次是要求LLM对聚合后的评论集合进行深度分析，并以JSON格式返回。
          - **4W1H 总结**: 总结该主题和情感下的共性场景、人群、原因等。
          - **核心需求提炼**: 总结出1-3条最核心的用户原始需求。
    4.  汇总所有主题的分析结果，并按全局提及量降序排列。
  - **输出**: `final_report.json`，一份结构化的、包含所有深度洞察的最终报告。

-----

## 4\. 文件结构说明 📂

```
.
├── 🚀 main.py                   # 主程序入口，串联整个流程
├── 🏷️ tag_process.py            # 步骤1: 关键词打标模块
├── 🧠 llm_analyze.py            # 步骤2: LLM情感与主题分析模块
├── 📝 generate_report.py        # 步骤3: LLM聚合与报告生成模块
|
├── ⚙️ config.yaml               # 核心配置文件，用于配置所有参数
├── 🔑 keywords.yaml             # 关键词库，用于步骤1的初步打标
├── 📚 topics.yaml               # 细分主题库，用于步骤2的LLM分析
|
├── 📥 input_data.csv            # 【需用户提供】原始评论数据文件
├── 📤 output_tagged.csv         # 步骤1的输出：带大类标签的数据
├── 📤 output_analyzed.csv       # 步骤2的输出：带细分主题和情感的数据
└── 📊 final_report.json         # 最终产出：深度分析报告
```

## 5\. 如何运行 🚀

### 5.1. 环境准备 🖥️

1.  确保您已安装 Python 3.x。
2.  安装所需的依赖库。建议创建一个虚拟环境：
    ```bash
    pip install pandas openai PyYAML tqdm
    ```

### 5.2. 参数配置 ⚙️

在运行前，请仔细检查并修改 `config.yaml` 文件：

  - **`file_paths`**:
      - `step1_input`: 确认输入文件名与您的原始数据文件名一致，默认为 `input_data.csv`。
      - 可以根据需要修改中间文件和最终报告的输出路径。
  - **`data_columns`**:
      - `comment_column_name`: **（重要）** 必须设置为您输入CSV文件中包含评论内容的列名，默认为“评论”。
  - **`llm_api`**:
      - `api_key`: **（重要）** 填入您的大语言模型服务提供商的 API Key。
      - `base_url`: 填入对应的 API 地址。
      - `tagging_model` / `report_model`: 根据需要指定用于不同阶段的模型名称。
  - **`execution`**:
      - `max_workers`: 根据您的网络和API并发限制，调整并发线程数。
      - `retry_attempts` / `retry_delay`: 配置API调用失败时的重试策略。

### 5.3. 自定义词库

**为了获得最精准的分析结果，强烈建议您根据分析的具体车型或场景，调整以下两个文件：**

  - **`keywords.yaml`**: 这个文件定义了粗分类的规则。

      - **为何调整？** 不同车型的用户讨论热点不同。例如，分析硬派越野车时，您可能需要增加“大梁”、“差速锁”、“接近角”等关键词；分析纯电车时，“800V”、“碳化硅”、“续航达成率”等是重点。
      - **如何调整？** 打开 `keywords.yaml`，直接在对应类别下增删关键词即可。

  - **`topics.yaml`**: 这个文件定义了细分主题，是LLM分析的基础。

      - **为何调整？** 不同车型的配置和卖点千差万别。例如，A车型可能主打“女王副驾”，B车型可能宣传“可编程大灯”，您需要将这些独特的配置或功能点作为细分主题加入到 `topics.yaml` 中，LLM才能准确地将其识别出来。
      - **如何调整？** 打开 `topics.yaml`，在对应大类下增加或修改细分主题列表。

通过定制这两个文件，您可以将本分析系统灵活地应用于任何车型的用户研究中。

### 5.4. 启动程序 ▶️

完成所有配置后，在终端中运行主程序：

```bash
python main.py
```

程序会依次执行三个步骤，并在控制台打印出当前进度。全部流程结束后，您将在项目根目录下找到最终的 `final_report.json` 文件。

## 6\. 输出报告解读 📊

最终生成的 `final_report.json` 文件是一个结构化的JSON对象，其核心内容如下：
```json
{
  "report_metadata": {
    "report_generated_at": "...", // 报告生成时间
    "source_file": "output_analyzed.csv", // 数据来源
    "total_topics_analyzed": 70, // 分析的总主题数
    "total_mentions_analyzed": 1500 // 分析的总提及次数
  },
  "all_topics_analysis": [ // 一个列表，按总提及数降序排列
    {
      "topic_name": "操控-底盘滤震与悬挂舒适性", // 细分主题名称
      "category": "操控", // 所属大类
      "statistics": {
        "mention_count": 125, // 该主题被提及的总次数
        "sentiment_distribution": { // 情感分布
          "正面": 50,
          "负面": 70,
          "中性": 5
        }
      },
      "analysis_by_sentiment": [ // 按情感分类的深度分析
        {
          "sentiment": "负面",
          "mention_count": 70,
          "consolidated_analysis": { // 4W1H 总结
            "when": "在经过减速带或不平整路面时",
            "where": "市区道路、国道",
            "why": "悬挂调教过硬，导致路感过于清晰，产生多余的颠簸和跳动",
            "who": "后排乘客，家庭用户",
            "how": "希望悬挂能更有韧性，或提供软硬可调的模式"
          },
          "core_needs": [ // 提炼的核心需求
            "用户需要在保证操控性的同时，提升车辆在日常行驶中对细碎震动的过滤能力。",
            "后排乘客期望获得更平稳、更舒适的乘坐体验。"
          ],
          "example_comments": [ // 示例原始评论
            "过个减速带感觉人都要飞起来了，底盘太硬了。",
            "..."
          ]
        },
        {
          "sentiment": "正面",
          "..." // 正面情感的分析
        }
      ]
    },
    // ... 其他主题的分析
  ]
}
```